{% extends "base.html" %}

{% block title %}Home - Product Comparison{% endblock %}

{% block extra_css %}
<style>
    /* Light Theme with Dark Items */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

    :root {
        /* Light Background */
        --bg-primary: #f8fafc;
        --bg-secondary: #f1f5f9;
        --bg-tertiary: #e2e8f0;
        
        /* Dark Items (Cards, Inputs, etc) */
        --dark-card: #1e293b;
        --dark-card-hover: #334155;
        --dark-border: #475569;
        --dark-text: #f1f5f9;
        --dark-text-muted: #cbd5e1;
        --dark-text-secondary: #94a3b8;
        
        /* Input Fields */
        --input-bg: #ffffff;
        --input-border: #e2e8f0;
        --input-text: #1e293b;
        --input-placeholder: #94a3b8;
        
        /* Accent Colors */
        --accent-primary: #3b82f6;
        --accent-secondary: #8b5cf6;
        --accent-gradient: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        
        /* Platform Colors */
        --amazon-color: #ff9900;
        --daraz-color: #f85606;
        
        /* Status Colors */
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --info-color: #3b82f6;
        
        /* UI Elements */
        --border-radius: 16px;
        --shadow-sm: 0 4px 6px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 10px 25px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    body {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        min-height: 100vh;
        font-family: 'Inter', sans-serif;
        color: #1e293b;
    }

    /* Container */
    .container {
        position: relative;
        z-index: 1;
        padding: 2rem 1rem;
    }

    /* Hero Section */
    .hero-section {
        text-align: center;
        margin-bottom: 3rem;
        animation: fadeInDown 0.8s ease;
    }

    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .hero-title {
        font-size: 3.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        
        -webkit-text-fill-color: transparent;
        margin-bottom: 1rem;
        position: relative;
        display: inline-block;
    }

    .hero-title::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 4px;
        background: var(--accent-gradient);
        border-radius: 2px;
    }

    .hero-subtitle {
        font-size: 1.2rem;
        color: #475569;
        max-width: 600px;
        margin: 1rem auto 0;
        line-height: 1.6;
    }

    /* Stats Bar */
    .stats-bar {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-bottom: 3rem;
        flex-wrap: wrap;
        animation: fadeInUp 0.8s ease 0.2s both;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .stat-item {
        background: var(--dark-card);
        padding: 1.5rem 2.5rem;
        border-radius: var(--border-radius);
        display: flex;
        align-items: center;
        gap: 1.5rem;
        transition: all 0.3s ease;
        box-shadow: var(--shadow-lg);
    }

    .stat-item:hover {
        transform: translateY(-5px);
        background: var(--dark-card-hover);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
    }

    .stat-content {
        text-align: left;
    }

    .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: white;
        line-height: 1.2;
    }

    .stat-label {
        font-size: 0.9rem;
        color: var(--dark-text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Main Search Card */
    .search-card {
        background: var(--dark-card);
        border-radius: var(--border-radius);
        overflow: hidden;
        animation: fadeInUp 0.8s ease 0.4s both;
        box-shadow: var(--shadow-lg);
    }

    .search-card-header {
        background: linear-gradient(135deg, var(--dark-card-hover) 0%, var(--dark-card) 100%);
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--dark-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .search-card-header h4 {
        font-size: 1.5rem;
        font-weight: 700;
        color: white;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .search-card-header h4 i {
        color: var(--accent-primary);
        font-size: 1.8rem;
    }

    .unlimited-badge {
        background: var(--accent-gradient);
        color: white;
        padding: 0.35rem 1rem;
        border-radius: 50px;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .search-card-body {
        padding: 2rem;
    }

    /* Form Groups */
    .form-group {
        margin-bottom: 2rem;
    }

    .form-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
        color: white;
        margin-bottom: 0.75rem;
        font-size: 1rem;
    }

    .form-label i {
        color: var(--accent-primary);
    }

    /* Input Fields */
    .form-control, .form-select {
        width: 100%;
        padding: 1rem 1.25rem;
        background: white;
        border: 2px solid var(--input-border);
        border-radius: 12px;
        color: var(--input-text);
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        outline: none;
    }

    .form-control::placeholder {
        color: var(--input-placeholder);
    }

    /* Platform Checkboxes */
    .platform-checkbox {
        background: var(--dark-card-hover);
        border: 1px solid var(--dark-border);
        border-radius: 12px;
        padding: 1.25rem;
        transition: all 0.3s ease;
        height: 100%;
    }

    .platform-checkbox:hover {
        transform: translateY(-3px);
        background: var(--dark-card);
        border-color: var(--accent-primary);
    }

    .form-check-input {
        width: 1.3em;
        height: 1.3em;
        margin-top: 0.25em;
        cursor: pointer;
        border: 2px solid var(--dark-border);
    }

    .form-check-input:checked {
        background-color: var(--accent-primary);
        border-color: var(--accent-primary);
    }

    .form-check-label {
        color: white;
        font-weight: 600;
        cursor: pointer;
        margin-left: 0.75rem;
    }

    .form-check-label i.bi-amazon {
        color: var(--amazon-color);
    }

    .form-check-label i.bi-shop {
        color: var(--daraz-color);
    }

    .form-check-label small {
        color: var(--dark-text-secondary);
        font-weight: normal;
        margin-top: 0.25rem;
        display: block;
    }

    /* Info Text */
    .info-text {
        color: var(--dark-text-secondary);
        font-size: 0.9rem;
        margin-top: 0.5rem;
    }

    .info-text i {
        color: var(--info-color);
    }

    .time-warning {
        color: var(--warning-color);
        margin-top: 0.5rem;
    }

    /* Alert Message */
    .alert-warning {
        background: rgba(245, 158, 11, 0.15);
        border: 1px solid var(--warning-color);
        color: var(--warning-color);
        border-radius: 12px;
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }

    .alert-warning i {
        font-size: 1.3rem;
    }

    /* Submit Button */
    .btn-primary {
        background: var(--accent-gradient);
        border: none;
        padding: 1.25rem;
        font-weight: 700;
        font-size: 1.1rem;
        border-radius: 12px;
        color: white;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: var(--shadow-md);
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-lg);
    }

    /* Information Card */
    .info-card {
        background: var(--dark-card);
        border-radius: var(--border-radius);
        margin-top: 2rem;
        animation: fadeInUp 0.8s ease 0.6s both;
        box-shadow: var(--shadow-lg);
    }

    .info-header {
        background: linear-gradient(135deg, var(--dark-card-hover) 0%, var(--dark-card) 100%);
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--dark-border);
    }

    .info-header h5 {
        color: white;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .info-header h5 i {
        color: var(--info-color);
    }

    .info-body {
        padding: 1.5rem;
    }

    /* Lists */
    .info-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .info-list li {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 0;
        color: var(--dark-text-secondary);
        border-bottom: 1px solid var(--dark-border);
    }

    .info-list li:last-child {
        border-bottom: none;
    }

    .info-list li i {
        width: 24px;
        color: var(--accent-primary);
        font-size: 1.2rem;
    }

    .info-list li i.text-warning {
        color: var(--warning-color);
    }

    .info-list li i.text-danger {
        color: var(--danger-color);
    }

    /* Stats Preview */
    .stats-preview {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-top: 1.5rem;
    }

    .stat-preview-item {
        background: var(--dark-card-hover);
        padding: 1rem;
        border-radius: 12px;
        text-align: center;
    }

    .stat-preview-label {
        font-size: 0.8rem;
        color: var(--dark-text-muted);
        margin-bottom: 0.25rem;
    }

    .stat-preview-value {
        font-size: 1.3rem;
        font-weight: 700;
        color: white;
    }

    .stat-preview-value.text-warning {
        color: var(--warning-color);
    }

    .stat-preview-value.text-danger {
        color: var(--daraz-color);
    }

    .stat-preview-value.text-success {
        color: var(--success-color);
    }

    /* Recent Search Card */
    .recent-card {
        background: var(--dark-card);
        border-radius: var(--border-radius);
        margin-top: 2rem;
        padding: 1.25rem 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        animation: slideIn 0.5s ease;
        box-shadow: var(--shadow-lg);
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .recent-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .recent-info i {
        font-size: 1.5rem;
        color: var(--accent-primary);
    }

    .recent-text {
        color: var(--dark-text-muted);
    }

    .recent-text strong {
        color: white;
        margin-left: 0.5rem;
    }

    .recent-btn {
        padding: 0.5rem 1.25rem;
        background: transparent;
        border: 2px solid var(--accent-primary);
        border-radius: 8px;
        color: var(--accent-primary);
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .recent-btn:hover {
        background: var(--accent-primary);
        color: white;
    }

    /* Loading Overlay */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }

    .loading-overlay.show {
        display: flex;
    }

    .loading-content {
        background: var(--dark-card);
        padding: 2rem 3rem;
        border-radius: var(--border-radius);
        text-align: center;
        box-shadow: var(--shadow-lg);
    }

    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid var(--dark-border);
        border-top-color: var(--accent-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1.5rem;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .loading-text {
        color: white;
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .loading-subtext {
        color: var(--dark-text-muted);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .hero-title {
            font-size: 2.5rem;
        }

        .stats-bar {
            gap: 1rem;
        }

        .stat-item {
            width: 100%;
            padding: 1rem 1.5rem;
        }

        .stats-preview {
            grid-template-columns: 1fr;
        }

        .recent-card {
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }

        .recent-info {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}


<!-- Stats Bar -->


<!-- Main Search Card -->
<div class="search-card">
    <div class="search-card-header">
        <h4>
            <i class="bi bi-search"></i>
            Search Products
        </h4>
        <span class="unlimited-badge">
            <i class="bi bi-infinity"></i> Unlimited
        </span>
    </div>
    
    <div class="search-card-body">
        <form action="{{ url_for('search') }}" method="POST" id="searchForm">
            <!-- Product Input -->
            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-box-seam"></i>
                    What are you looking for?
                </label>
                <input type="text" class="form-control" id="query" name="query" 
                       placeholder="e.g., iPhone 15, Samsung TV, Nike Shoes..." 
                       value="{{ session.get('last_query', '') }}"
                       required
                       autocomplete="off">
            </div>
            
            <!-- Platform Selection -->
            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-grid-3x3-gap-fill"></i>
                    Select Platforms to Compare
                </label>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="platform-checkbox">
                            <input class="form-check-input" type="checkbox" name="platforms" value="amazon" id="amazon" checked>
                            <label class="form-check-label" for="amazon">
                                <i class="bi bi-amazon"></i> Amazon
                                <small class="d-block">US prices in PKR</small>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="platform-checkbox">
                            <input class="form-check-input" type="checkbox" name="platforms" value="daraz" id="daraz" checked>
                            <label class="form-check-label" for="daraz">
                                <i class="bi bi-shop"></i> Daraz
                                <small class="d-block">Local Pakistani prices</small>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pages Selection -->
            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-files"></i>
                    Number of Pages to Scrape
                </label>
                <select class="form-select" id="pages" name="pages">
                    <option value="1">üìÑ 1 Page (Fast)</option>
                    <option value="2">üìÑüìÑ 2 Pages</option>
                    <option value="3">üìÑüìÑüìÑ 3 Pages</option>
                    <option value="5">üìÑüìÑüìÑüìÑüìÑ 5 Pages</option>
                    <option value="10">üîü 10 Pages</option>
                    <option value="all" selected>üåê ALL Pages (Unlimited)</option>
                </select>
                <div class="info-text mt-2">
                    <i class="bi bi-info-circle"></i> 
                    "ALL Pages" scrapes until no more products found
                </div>
                <div class="time-warning mt-2">
                    <i class="bi bi-clock-history"></i> 
                    Time: 2-10 minutes for unlimited pages
                </div>
            </div>
            
            <!-- Warning Message -->
            <div class="alert-warning" id="warningMessage" style="display: none;">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <span id="warningText"></span>
            </div>
            
            <!-- Submit Button -->
            <button type="submit" class="btn-primary" id="searchBtn">
                <i class="bi bi-search"></i>
                <span>Search & Compare Products</span>
                <i class="bi bi-arrow-right"></i>
            </button>
        </form>
    </div>
</div>

<!-- Information Card -->
<div class="info-card">
    <div class="info-header">
        <h5>
            <i class="bi bi-info-circle"></i>
            Unlimited Scraping Information
        </h5>
    </div>
    <div class="info-body">
        <div class="row">
            <div class="col-md-6">
                <ul class="info-list">
                    <li>
                        <i class="bi bi-amazon text-warning"></i>
                        <span>Amazon: <strong>~16 products</strong> per page</span>
                    </li>
                    <li>
                        <i class="bi bi-shop text-danger"></i>
                        <span>Daraz: <strong>~40 products</strong> per page</span>
                    </li>
                    <li>
                        <i class="bi bi-database"></i>
                        <span>Total could be <strong>hundreds</strong> of products</span>
                    </li>
                </ul>
            </div>
            <div class="col-md-6">
                <ul class="info-list">
                    <li>
                        <i class="bi bi-hourglass-split"></i>
                        <span>Be patient - large scrapes take time</span>
                    </li>
                    <li>
                        <i class="bi bi-arrow-repeat"></i>
                        <span>Don't refresh the page</span>
                    </li>
                    <li>
                        <i class="bi bi-file-earmark-spreadsheet"></i>
                        <span>Export handles unlimited data</span>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Stats Preview -->
        <div class="stats-preview">
            <div class="stat-preview-item">
                <div class="stat-preview-label">Amazon Avg</div>
                <div class="stat-preview-value text-warning">16/page</div>
            </div>
            <div class="stat-preview-item">
                <div class="stat-preview-label">Daraz Avg</div>
                <div class="stat-preview-value text-danger">40/page</div>
            </div>
            <div class="stat-preview-item">
                <div class="stat-preview-label">Max Pages</div>
                <div class="stat-preview-value text-success">Unlimited</div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Search Card -->
{% if session.get('last_query') %}
<div class="recent-card">
    <div class="recent-info">
        <i class="bi bi-clock-history"></i>
        <span class="recent-text">
            Last search: <strong>"{{ session.get('last_query') }}"</strong>
        </span>
    </div>
    <a href="{{ url_for('compare') }}" class="recent-btn">
        View Results <i class="bi bi-arrow-right ms-2"></i>
    </a>
</div>
{% endif %}

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
        <div class="loading-spinner"></div>
        <div class="loading-text">Scraping Products...</div>
        <div class="loading-subtext" id="loadingSubtext">This may take a few minutes</div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Page selection warning
document.getElementById('pages').addEventListener('change', function(e) {
    const warning = document.getElementById('warningMessage');
    const warningText = document.getElementById('warningText');
    const loadingSubtext = document.getElementById('loadingSubtext');
    
    if (this.value === 'all') {
        warning.style.display = 'flex';
        warningText.innerHTML = 'üåê You selected ALL pages. This will scrape every available page until no more products are found. This may take several minutes.';
        loadingSubtext.textContent = 'Scraping ALL pages - this may take several minutes';
    } else if (parseInt(this.value) > 5) {
        warning.style.display = 'flex';
        warningText.innerHTML = `‚è±Ô∏è You selected ${this.value} pages. Estimated time: ${parseInt(this.value) * 30} seconds to ${parseInt(this.value) * 60} seconds.`;
        loadingSubtext.textContent = `Scraping ${this.value} pages - please wait`;
    } else {
        warning.style.display = 'none';
        loadingSubtext.textContent = `Scraping ${this.value} page${this.value > 1 ? 's' : ''} - please wait`;
    }
});

// Form submission
document.getElementById('searchForm').addEventListener('submit', function(e) {
    const btn = document.getElementById('searchBtn');
    const pages = document.getElementById('pages').value;
    const platforms = document.querySelectorAll('input[name="platforms"]:checked').length;
    const query = document.getElementById('query').value.trim();
    
    // Validation
    if (!query) {
        e.preventDefault();
        alert('‚ö†Ô∏è Please enter a product name to search.');
        return;
    }
    
    if (platforms === 0) {
        e.preventDefault();
        alert('‚ö†Ô∏è Please select at least one platform to search.');
        return;
    }
    
    // Show loading overlay
    document.getElementById('loadingOverlay').classList.add('show');
    
    // Update button state
    btn.innerHTML = '<i class="bi bi-hourglass-split"></i><span>Searching...</span>';
    btn.disabled = true;
    
    // Confirm for all pages
    if (pages === 'all') {
        if (!confirm('üåê This will scrape ALL available pages and may take several minutes. Continue?')) {
            e.preventDefault();
            document.getElementById('loadingOverlay').classList.remove('show');
            btn.innerHTML = '<i class="bi bi-search"></i><span>Search & Compare Products</span><i class="bi bi-arrow-right"></i>';
            btn.disabled = false;
        }
    }
});

// Enter key shortcut
document.getElementById('query').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('searchForm').submit();
    }
});

// Animate on load
document.addEventListener('DOMContentLoaded', function() {
    // Set initial time estimate
    const pages = document.getElementById('pages').value;
    if (pages === 'all') {
        document.getElementById('loadingSubtext').textContent = 'Scraping ALL pages - this may take several minutes';
    }
    
    // Animate cards
    const cards = document.querySelectorAll('.stat-item, .search-card, .info-card');
    cards.forEach((card, index) => {
        card.style.animation = `fadeInUp 0.6s ease ${index * 0.1}s both`;
    });
});
</script>
{% endblock %}